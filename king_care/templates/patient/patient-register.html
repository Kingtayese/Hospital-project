{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>Patient Register - King Care Hospital</title>
  <meta content="" name="description">
  <meta content="" name="keywords">

  <!-- Favicons -->
  <link href="{% static 'img/favicon.png' %}" rel="icon">
  <link href="{% static 'img/apple-touch-icon.png' %}" rel="apple-touch-icon">

  <!-- Google Fonts -->
  <link href="https://fonts.gstatic.com" rel="preconnect">
  <link
    href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
    rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="{% static 'vendor/bootstrap/css/bootstrap.min.css' %}" rel="stylesheet">
  <link href="{% static 'vendor/bootstrap-icons/bootstrap-icons.css' %}" rel="stylesheet">
  <link href="{% static 'vendor/boxicons/css/boxicons.min.css' %}" rel="stylesheet">
  <link href="{% static 'vendor/quill/quill.snow.css' %}" rel="stylesheet">
  <link href="{% static 'vendor/quill/quill.bubble.css' %}" rel="stylesheet">
  <link href="{% static 'vendor/remixicon/remixicon.css' %}" rel="stylesheet">
  <link href="{% static 'vendor/simple-datatables/style.css' %}" rel="stylesheet">
  <link href="{% static 'css/alertify.css' %}" rel="stylesheet">
  <link href="{% static 'css/alertify.min.css' %}" rel="stylesheet">
  <script src="{% static 'CDN/jquery-3.1.1.min.js' %}"></script>
  <link href="{% static 'CDN/jquery-ui.min.css' %}" rel="stylesheet">
  <script src="{% static 'CDN/jquery-ui.min.js' %}"></script>

  <!-- Template Main CSS File -->
  <link href="{% static 'css/style.css' %}" rel="stylesheet">

  <!-- =======================================================
  * Template Name: NiceAdmin
  * Updated: Mar 09 2023 with Bootstrap v5.2.3
  * Template URL: https://bootstrapmade.com/nice-admin-bootstrap-admin-html-template/
  * Author: BootstrapMade.com
  * License: https://bootstrapmade.com/license/
  ======================================================== -->
</head>

<body>

  <main>
    <div class="container">

      <section class="section register min-vh-100 d-flex flex-column align-items-center justify-content-center py-4">
        <div class="container">
          <div class="row justify-content-center">
            <div class="col-lg-6 col-md-8 d-flex flex-column align-items-center justify-content-center">

              <div class="d-flex justify-content-center py-4">
                <a href="index.html" class="logo d-flex align-items-center w-auto">
                  <img src="{% static 'img/logo.png' %}" alt="">
                  <span class="d-none d-lg-block">King Care Hospital</span>
                </a>
              </div><!-- End Logo -->

              <div class="card mb-3">

                <div class="card-body">

                  <div class="pt-4 pb-2">
                    <h5 class="card-title text-center pb-0 fs-4">Create an Account</h5>
                    <p class="text-center small">Enter your personal details to create account</p>
                  </div>

                  <form method="POST" class="row g-3 needs-validation" novalidate enctype="multipart/form-data">
                    {% csrf_token %}
                    <div style="width: 140px; height: 140px;">
                      <img src="#" id="my_image" alt="" style="width: 140px; height: 140px; border: 2px solid green">
                    </div>

                    <input type="file" id="upload_file" name="fileToUpload" accept="image/*" required />


                    <script>
                      window.addEventListener('load', function () {
                        document.querySelector('input[type="file"]').addEventListener('change', function () {
                          if (this.files && this.files[0]) {
                            var img = document.getElementById('my_image');  // $('img')[0]
                            var fi = document.getElementById('upload_file');
                            //   Calculate File Size to know what to upload         
                            if (fi.files.length > 0) {
                              //        LOAD IMAGE            
                              img.src = URL.createObjectURL(this.files[0]); // set src to blob url
                              img.onload = imageIsLoaded;
                            }
                          }
                        });
                      });
                    </script>

                    <div class="col-12">
                      <label for="fullName" class="form-label">Your Name</label>
                      <input type="text" readonly name="get_fullName" class="form-control" id="fullName" required>
                      <div class="invalid-feedback">Please, enter your full name!</div>
                    </div>

                    <div class="col-12">
                      <label for="patient_no" class="form-label">Your Patient Number</label>
                      <input type="text" name="get_patient_no" class="form-control" id="patient_no" required>
                      <div class="invalid-feedback">Please, enter your Patient No!</div>
                    </div>

                    <div class="col-12">
                      <label for="phone" class="form-label">Your Phone</label>
                      <input type="tel" readonly name="get_phone" class="form-control" id="phone" required>
                      <div class="invalid-feedback">Please enter a valid Phone!</div>
                    </div>

                    <div class="col-12">
                      <label for="email" class="form-label">Your Email</label>
                      <input type="email" name="get_email" class="form-control" id="email" required>
                      <div class="invalid-feedback">Please enter a valid Email!</div>
                    </div>

                    <div class="col-12">
                      <label for="username" class="form-label">Username</label>
                      <div class="input-group has-validation">
                        <span class="input-group-text" id="inputGroupPrepend">@</span>
                        <input type="text" name="get_username" class="form-control" id="username" required>
                        <div class="invalid-feedback">Please choose a username.</div>
                      </div>
                    </div>

                    <div class="col-12">
                      <input type="text" name="get_address" readonly class="form-control" id="address" required>
                    </div>

                    <div class="col-12">
                      <input type="text" name="get_gender" readonly class="form-control" id="get_gender" required>
                    </div>

                    <div class="col-12">
                      <input type="text" name="get_dob" readonly class="form-control" id="dob" required>
                    </div>

                    <div class="col-12">
                      <input type="text" name="get_blood_group" readonly class="form-control" id="blood_group" required>
                    </div>

                    <div class="col-12">
                      <label for="yourPassword" class="form-label">Password</label>
                      <input type="password" name="get_password" class="form-control" id="yourPassword" required>
                      <div class="invalid-feedback">Please enter your password!</div>
                    </div>

                    <div class="col-12">
                      <label for="yourConfirmPassword" class="form-label">Confirm Password</label>
                      <input type="password" name="" class="form-control" id="yourConfirmPassword" required>
                      <div class="invalid-feedback">Please enter your confirm password!</div>
                    </div>

                    <div class="col-12">
                      <div class="form-check">
                        <input class="form-check-input" name="terms" type="checkbox" value="" id="acceptTerms" required>
                        <label class="form-check-label" for="acceptTerms">I agree and accept the <a href="#">terms and
                            conditions</a></label>
                        <div class="invalid-feedback">You must agree before submitting.</div>
                      </div>
                    </div>
                    <div class="col-12">
                      <button class="btn btn-primary w-100" id="check_pass" type="submit">Create Account</button>
                    </div>
                    <div class="col-12">
                      <p class="small mb-0">Already have an account? <a href="/patient_register/patient_login">Log in</a></p>
                    </div>
                  </form>

                </div>
              </div>

              <div class="credits">
                <!-- All the links in the footer should remain intact. -->
                <!-- You can delete the links only if you purchased the pro version. -->
                <!-- Licensing information: https://bootstrapmade.com/license/ -->
                <!-- Purchase the pro version with working PHP/AJAX contact form: https://bootstrapmade.com/nice-admin-bootstrap-admin-html-template/ -->
                Designed by <a href="https://bootstrapmade.com/">King Tayese</a>
              </div>

            </div>
          </div>
        </div>

      </section>

    </div>
  </main><!-- End #main -->

  <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i
      class="bi bi-arrow-up-short"></i></a>

  <!-- Vendor JS Files -->
  <script src="{% static 'vendor/apexcharts/apexcharts.min.js' %}"></script>
  <script src="{% static 'vendor/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
  <script src="{% static 'vendor/chart.js/chart.umd.js' %}"></script>
  <script src="{% static 'vendor/echarts/echarts.min.js' %}"></script>
  <script src="{% static 'vendor/quill/quill.min.js' %}"></script>
  <script src="{% static 'vendor/simple-datatables/simple-datatables.js' %}"></script>
  <script src="{% static 'vendor/tinymce/tinymce.min.js' %}"></script>
  <script src="{% static 'vendor/php-email-form/validate.js' %}"></script>
  <script src="{% static 'js/alertify.js' %}"></script>
  <script src="{% static 'js/alertify.min.js' %}"></script>

  <script>
    alertify.set('notifier', 'position', 'top-right');

    {% for msg in messages %}
    alertify.success('{{ msg }}');
    {% endfor %}

    $(document).ready(function () {
      $("#check_pass").click(function () {

        var yourPassword = document.getElementById("yourPassword").value;
        var yourConfirmPassword = document.getElementById("yourConfirmPassword").value;
        alertify.set('notifier', 'position', 'top-right');

        if (yourPassword === yourConfirmPassword) {
          return true;
        } else {
          alertify.error('Password Mismatch');
          return false;
        }
      })
    })

    $(document).ready(function () {
      $("#check_pass").click(function () {
        alertify.set('notifier', 'position', 'top-right');
        let image = $("#upload_file").val();
        let fullName = $("#fullName").val();
        let username = $("#username").val();
        let phone = $("#phone").val();
        let password = $("#yourPassword").val();
        let confirmPass = $("#yourConfirmPassword").val();
        if (image === '') {
          alertify.error('Choose Image');
          return false;
        } else if (fullName === '') {
          alertify.error('Enter Full Name');
          return false;
        } else if (phone === '') {
          alertify.error('Enter Phone Number');
          return false;
        } else if (username === '') {
          alertify.error('Enter Username');
          return false;
        } else if (password === '') {
          alertify.error('Enter Password');
          return false;
        } else if (confirmPass === '') {
          alertify.error('Enter Confirm Password');
          return false;
        } else {
          return true;
        }
      })
    })
  </script>

  <script type="text/javascript">
    $("#patient_no").keyup(function () {
      //alert('i see you');
      var patient_no = document.getElementById("patient_no").value;
      $.ajax({
        // --------REQUEST-------
        type: "GET",
        url: "/get_patient_name",
        data: {
          get_patient_no: patient_no,
        },

        // ---------------RESPONSES------------
        success: function (data) {
          $("#fullName").text(data);
          //alert(data);
          document.getElementById("fullName").value = data;
        },
      })
    })

    $("#patient_no").keyup(function () {
      //alert('i see you');
      var patient_no = document.getElementById("patient_no").value;
      $.ajax({
        // --------REQUEST-------
        type: "GET",
        url: "/get_patient_phone",
        data: {
          get_patient_no: patient_no,
        },

        // ---------------RESPONSES------------
        success: function (data) {
          $("#phone").text(data);
          //alert(data);
          document.getElementById("phone").value = data;
        },
      })
    })

    $("#patient_no").keyup(function () {
      //alert('i see you');
      var patient_no = document.getElementById("patient_no").value;
      $.ajax({
        // --------REQUEST-------
        type: "GET",
        url: "/get_patient_blood_group",
        data: {
          get_patient_no: patient_no,
        },

        // ---------------RESPONSES------------
        success: function (data) {
          $("#blood_group").text(data);
          //alert(data);
          document.getElementById("blood_group").value = data;
        },
      })
    })

    $("#patient_no").keyup(function () {
      //alert('i see you');
      var patient_no = document.getElementById("patient_no").value;
      $.ajax({
        // --------REQUEST-------
        type: "GET",
        url: "/get_patient_dob",
        data: {
          get_patient_no: patient_no,
        },

        // ---------------RESPONSES------------
        success: function (data) {
          $("#dob").text(data);
          //alert(data);
          document.getElementById("dob").value = data;
        },
      })
    })

    $("#patient_no").keyup(function () {
      //alert('i see you');
      var patient_no = document.getElementById("patient_no").value;
      $.ajax({
        // --------REQUEST-------
        type: "GET",
        url: "/get_patient_gender",
        data: {
          get_patient_no: patient_no,
        },

        // ---------------RESPONSES------------
        success: function (data) {
          $("#get_gender").text(data);
          //alert(data);
          document.getElementById("get_gender").value = data;
        },
      })
    })

    $("#patient_no").keyup(function () {
      //alert('i see you');
      var patient_no = document.getElementById("patient_no").value;
      $.ajax({
        // --------REQUEST-------
        type: "GET",
        url: "/get_patient_addresses",
        data: {
          get_patient_no: patient_no,
        },

        // ---------------RESPONSES------------
        success: function (data) {
          $("#address").text(data);
          //alert(data);
          document.getElementById("address").value = data;
        },
      })
    })
  </script>

  <!-- Template Main JS File -->
  <script src="{% static 'js/main.js' %}"></script>

</body>

</html>